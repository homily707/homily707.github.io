<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.100.2"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>æ–¯æ˜¯é™‹å®¤</title><meta name=keywords content="Blog,Portfolio,PaperMod"><meta name=description content="å‹¿åœ¨æµ®æ²™ç­‘é«˜å°"><meta name=author content="Me"><link rel=canonical href=https://homily707.github.io/><link crossorigin=anonymous href=/assets/css/stylesheet.d7fb4cbf980fe688a21621b06a795933c4e6bb2d4070ec940667af1715d84af2.css integrity="sha256-1/tMv5gP5oiiFiGwanlZM8Tmuy1AcOyUBmevFxXYSvI=" rel="preload stylesheet" as=style><link rel=icon href=https://homily707.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://homily707.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://homily707.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://homily707.github.io/apple-touch-icon.png><link rel=mask-icon href=https://homily707.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://homily707.github.io/index.xml><link rel=alternate type=application/json href=https://homily707.github.io/index.json><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="æ–¯æ˜¯é™‹å®¤"><meta property="og:description" content="å‹¿åœ¨æµ®æ²™ç­‘é«˜å°"><meta property="og:type" content="website"><meta property="og:url" content="https://homily707.github.io/"><meta property="og:site_name" content="mysite"><meta name=twitter:card content="summary"><meta name=twitter:title content="æ–¯æ˜¯é™‹å®¤"><meta name=twitter:description content="å‹¿åœ¨æµ®æ²™ç­‘é«˜å°"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"æ–¯æ˜¯é™‹å®¤","url":"https://homily707.github.io/","description":"å‹¿åœ¨æµ®æ²™ç­‘é«˜å°","thumbnailUrl":"https://homily707.github.io/favicon.ico","sameAs":["https://bilibili.com/","https://www.github.com/homily707"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://homily707.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://homily707.github.io/tags/algo/ title=ç®—æ³•><span>ç®—æ³•</span></a></li><li><a href=https://homily707.github.io/tags/data/ title=æ•°æ®åº“><span>æ•°æ®åº“</span></a></li><li><a href=https://homily707.github.io/tags/k8s/ title=k8s><span>k8s</span></a></li><li><a href=https://homily707.github.io/tags/go/ title=go><span>go</span></a></li><li><a href=https://homily707.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://homily707.github.io/search title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>Hi there ğŸ‘‹</h1></header><div class=entry-content>Welcome to my blog</div><footer class=entry-footer><div class=social-icons><a href=https://bilibili.com/ target=_blank rel="noopener noreferrer me" title=Bilibili><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" xmlns="http://www.w3.org/2000/svg"><rect x="1.3333" y="6" width="21.333" height="15.333" rx="4" ry="4"/><path d="m8 12.4v1.2"/><path d="m16 12.4v1.2"/><path d="m5.8853 2.6667L8.552 5.3334"/><path d="m18.115 2.6667-2.6667 2.6667"/></svg></a><a href=https://www.github.com/homily707 target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2>Client Go</h2></header><div class=entry-content><p>work queue Queue
queue []t // å®šä¹‰å…ƒç´ çš„å¤„ç†é¡ºåºï¼Œé‡Œé¢æ‰€æœ‰å…ƒç´ éƒ½åº”è¯¥åœ¨ dirty set ä¸­æœ‰ï¼Œè€Œä¸èƒ½å‡ºç°åœ¨ processing set ä¸­ dirty set // æ ‡è®°æ‰€æœ‰éœ€è¦è¢«å¤„ç†çš„å…ƒç´  processing set // å½“å‰æ­£åœ¨è¢«å¤„ç†çš„å…ƒç´ ï¼Œå½“å¤„ç†å®Œåéœ€è¦æ£€æŸ¥è¯¥å…ƒç´ æ˜¯å¦åœ¨ dirty set ä¸­ï¼Œå¦‚æœæœ‰åˆ™æ·»åŠ åˆ° queue é‡Œ DelayingQueue å¤šäº†ä¸€ä¸ªAddAfterï¼Œæ¯æ¬¡addåŠ å…¥å †ä¸­ï¼Œæ¯æ¬¡æ‹¿å‡ºæœ€æ—©çš„
RateLimitingQueueã€‚é™é€Ÿé˜Ÿåˆ—
Delta FIFO æ¥å£queue
æ¥å£store
items map[string]Delta
Delta. äº”ç§type added updated deleted replaced sync . å¸¦ä¸€ä¸ª interface{}
Popæ–¹æ³•ï¼šä¼šé˜»å¡ã€‚ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœæ‰§è¡Œå¤±è´¥é‡æ–°å…¥é˜Ÿ
Indexer type Indexer interface { Store Index(indexName string, obj interface{}) ([]interface{}, error) // æ ¹æ®ç´¢å¼•åå’Œç»™å®šçš„å¯¹è±¡è¿”å›ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰å¯¹è±¡ IndexKeys(indexName, indexedValue string) ([]string, error) // æ ¹æ®ç´¢å¼•åå’Œç´¢å¼•å€¼è¿”å›ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰å¯¹è±¡çš„ key ListIndexFuncValues(indexName string) []string // åˆ—å‡ºç´¢å¼•å‡½æ•°è®¡ç®—å‡ºæ¥çš„æ‰€æœ‰ç´¢å¼•å€¼ ByIndex(indexName, indexedValue string) ([]interface{}, error) // æ ¹æ®ç´¢å¼•åå’Œç´¢å¼•å€¼è¿”å›ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰å¯¹è±¡ GetIndexers() Indexers // è·å–æ‰€æœ‰çš„ Indexersï¼Œå¯¹åº” map[string]IndexFunc ç±»å‹ AddIndexers(newIndexers Indexers) error // è¿™ä¸ªæ–¹æ³•è¦åœ¨æ•°æ®åŠ å…¥å­˜å‚¨å‰è°ƒç”¨ï¼Œæ·»åŠ æ›´å¤šçš„ç´¢å¼•æ–¹æ³•ï¼Œé»˜è®¤åªé€šè¿‡ namespace æ£€ç´¢ } type Store interface { Add(obj interface{}) error Update(obj interface{}) error Delete(obj interface{}) error List() []interface{} ListKeys() []string Get(obj interface{}) (item interface{}, exists bool, err error) GetByKey(key string) (item interface{}, exists bool, err error) Replace([]interface{}, string) error Resync() error } // é»˜è®¤å®ç°ç±» type cache struct { cacheStorage ThreadSafeStore keyFunc KeyFunc } keyfunc è®¡ç®— objectçš„keyï¼Œç„¶åç”¨ThreadSafeStoreå­˜å‚¨keyï¼šobject...</p></div><footer class=entry-footer><span title='2022-06-10 22:39:11 +0800 CST'>June 10, 2022</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;679 words&nbsp;Â·&nbsp;homily</footer><a class=entry-link aria-label="post link to Client Go" href=https://homily707.github.io/posts/k8s/client-go/></a></article><article class=post-entry><header class=entry-header><h2>6.824 Lab2 Coding</h2></header><div class=entry-content><p>flow
livelocks ç³»ç»Ÿæ²¡æœ‰é˜»å¡ã€‚ä½†æ˜¯çŠ¶æ€æ¥å›è½¬æ¢ï¼Œæ²¡æœ‰è¿›å±•ã€‚æ¯”å¦‚å¤šèŠ‚ç‚¹åŒæ—¶ç«é€‰ã€‚
å½“æ”¶åˆ°å¿ƒè·³ã€è‡ªå·±å‚ä¸ç«é€‰ã€æ”¶åˆ°ç«é€‰ç”³è¯·æ—¶ï¼Œä¸‰ç§æƒ…å†µä¸‹ï¼Œéƒ½è¦é‡ç½®election timeout è®¡æ—¶
Incorrect RPC handler å¦‚æœreply falseï¼Œå¿«é€Ÿç»“æŸï¼Œä¸è¦æ‰§è¡Œå…¶ä½™å­è¿‡ç¨‹ entriesä¸ºnullçš„rpcä¹Ÿè¦å¤„ç† æ—¥å¿—å¤„ç†çš„rule5æ˜¯å¿…è¦çš„ Failure to follow rule ç¡®ä¿applyåªè¿›è¡Œäº†ä¸€æ¬¡ å‘¨æœŸæ£€æŸ¥commitå’Œapplyæˆ–è€…æ¯æ¬¡commitæ—¶apply å¦‚æœappend ç”±äºtermä¸ä¸€è‡´è¢«æ‹’ç»ï¼Œä¸è¦æ›´æ–°nextIndex ä¸èƒ½æ›´æ–°ä»¥å‰termçš„commit Term confusion å½“è·å¾—æ¥è‡ªä»¥å‰termçš„replyã€‚å¦‚æœtermä¸åŒï¼Œä¸å¤„ç† 2Aï¼šleader election å®˜æ–¹hints
RequestVote å‚åŠ ç«é€‰ handler å‚ä¸æŠ•ç¥¨ã€‚5ç§’å†…é€‰å‡ºæ–°leader AppendEntries å¿ƒè·³ã€‚ æ¯ç§’ä¸è¶…è¿‡åæ¬¡ çŠ¯çš„å‡ ä¸ªé”™ï¼š
å¿˜äº†ç»´æŠ¤votedForçš„å€¼ å¿ƒè·³çš„é—´éš”æ—¶é—´è¦ç¡®ä¿å°äºéšæœºcheckæ—¶é—´ æ—§ä¸»ä»¥åŠç«é€‰å¤±è´¥è€… æ”¶åˆ°å¿ƒè·³æ—¶ï¼Œæ²¡æœ‰é€€åŒ– æ—§ä¸»disconnectsï¼Œè¿›å…¥electionï¼Œä½†æ˜¯æ²¡æœ‰ç«é€‰ leader ä¹Ÿç»™è‡ªå·±å‘äº†å¿ƒè·³ æ”¶åˆ°ç«é€‰ï¼Œåœæ­¢å¿ƒè·³æ£€æŸ¥ï¼Œåœæ­¢å‚åŠ ç«é€‰ è®¡ç¥¨ç»Ÿè®¡ï¼Œæ²¡æœ‰å¹¶å‘æ§åˆ¶ å‚ä¸ç«é€‰ï¼Œè¦å¹¶å‘æ‰§è¡Œ å‡ ä¸ªå®ç°ï¼š
log æ ‡å‡†åŒ–ï¼Œæ¯æ¬¡æ‰“å°å½“å‰ raftçš„çŠ¶æ€çš„ï¼Œå¹¶ç”¨emojiæ¥åŒºåˆ† log.SetFlags(log.Lmicroseconds) å¯å˜å‚æ•°çš„å¼•ç”¨å’Œè§£å¼•ç”¨ func (rf Raft) Log(format string, args ...interface{}) { RaftPrintf(format, args...) } 2Bï¼šlog å®˜æ–¹hints
å®ç° election restriction å¯èƒ½ä¼šå‡ºç°å¤šä¸»çš„bugï¼Œè¯·æŸ¥çœ‹timerçš„å®ç°æˆ–è€…ä¸è¦ç«‹åˆ»å‘å¿ƒè·³ é€šè¿‡condition æˆ–è€… sleepï¼Œä¸è¦è®©æ£€æŸ¥çŠ¶æ€çš„è¿›ç¨‹æ­»å¾ªç¯ çŠ¯çš„é”™...</p></div><footer class=entry-footer><span title='2022-05-02 13:09:12 +0800 CST'>May 2, 2022</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;78 words&nbsp;Â·&nbsp;homily</footer><a class=entry-link aria-label="post link to 6.824 Lab2 Coding" href=https://homily707.github.io/posts/db/6.824-lab2-coding/></a></article><article class=post-entry><header class=entry-header><h2>6.824 Lab2 Paper</h2></header><div class=entry-content><p>replicated state machines å¤šä¸ªçŠ¶æ€æœºä¿æŒç›¸åŒçš„çŠ¶æ€
å®ç°ï¼Œé€šè¿‡æ—¥å¿—ï¼ŒæŒ‰é¡ºåºä¿å­˜commandã€‚å…ˆå¤åˆ¶ï¼Œå†æ‰§è¡Œ
éæ‹œå åº­é—®é¢˜ä¸‹æ­£å¸¸å·¥ä½œ å¤šæ•°èŠ‚ç‚¹å¯ç”¨æ—¶æ•´ä½“å¯ç”¨ paxos ç¼ºç‚¹ éš¾ä»¥ç†è§£ã€ä¸å¥½å®ç°
è®¾è®¡ åˆ†è§£ã€å‡å°‘çŠ¶æ€
algorithm basics æœ€å°‘5ä¸ªèŠ‚ç‚¹ ä¸‰ç§èŠ‚ç‚¹ leaderã€followerã€candidate æ¯ä¸€æ¬¡é€‰ä¸¾éƒ½æ˜¯ä¸€æ¬¡termï¼Œé€‰ä¸¾å¤±è´¥ä¹Ÿç®—ä¸€æ¬¡ã€‚ æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å½“å‰ termï¼Œå¹¶åœ¨æ¯æ¬¡äº¤æµä¸­å¸¦ä¸Šï¼Œå¦‚æœè‡ªå·±è¿‡æ—¶äº†ï¼ˆä¹ƒä¸çŸ¥æœ‰æ±‰ï¼Œæ— è®ºé­æ™‹ï¼‰ï¼Œåˆ™è·Ÿä¸Šæœ€æ–°çš„ã€‚leaderå’Œcandidater å¦‚æœå‘ç°è¿‡æ—¶ï¼Œé€€ä¸ºfollower RPC æœ‰ä¸¤ç§voteã€ append ã€ ï¼ˆretryï¼‰ é€‰ä¸» å¿ƒè·³ å¼€å§‹éƒ½æ˜¯followerã€‚leaderä¼šå®šæœŸå‘é€å¿ƒè·³ï¼ˆæ²¡æœ‰logçš„ appendRpcï¼‰
election timeoutï¼Œfolloweré•¿æœŸæ²¡æ”¶åˆ°å¿ƒè·³ï¼Œå¼€å§‹ç«é€‰ã€‚å¢åŠ  termï¼Œåˆ‡ä¸º candidateï¼Œå¼€å§‹å¾ªç¯ç»™æ‰€æœ‰äººå‘é€ voteRpcã€‚ä¼šæœ‰3ç§ç»“æœ è‡ªå·±é€‰ä¸Šã€åˆ«äººé€‰ä¸Šã€è¶…æ—¶
é€‰ä¸¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹æŠ•ç¥¨ç»™ç¬¬ä¸€ä¸ªæ‰¾è‡ªå·±ç«é€‰çš„ï¼Œå‚é€‰è€…æŠ•è‡ªå·±ã€‚
æ”¶åˆ°è¶…è¿‡åŠæ•°çš„æŠ•ç¥¨ï¼Œè‡ªå·±ä¸Šä»»ï¼Œç»™åˆ«äººå‘å¿ƒè·³ã€‚å¦‚æœæ”¶åˆ°ç«é€‰termçš„leaderæŒ‡ä»¤ï¼Œä»£è¡¨è‡ªå·±å¤±è´¥ã€‚
å¦‚æœè¶…æ—¶ï¼Œå¢åŠ termï¼Œé‡æ–°ç«é€‰ã€‚
é˜²æ­¢å¤šäººå‚é€‰ï¼Œéšæœºelection timeoutã€‚candidateéœ€è¦æ¯æ¬¡é€‰ä¸¾å‰ï¼Œæ›´æ–°éšæœºtimeout
æ—¥å¿—å¤åˆ¶ å…ˆç¾¤å‘ appendRpcã€‚è¶…è¿‡åŠæ•°ç¡®è®¤ï¼Œç„¶åcommitã€‚appendä¸­ä¸‹å‘commited index è¶…æ—¶æ— å“åº”ï¼Œé‡å‘
æ—¥å¿—ä¿¡æ¯ä¿å­˜term
append å¸¦ä¸Š ä¸Šä¸€æ¬¡çš„entryï¼Œfolloweræ²¡æ‰¾åˆ°è¿™ä¸ªçš„è¯ï¼Œè¯´æ˜æœ‰æ¼ï¼Œå°±ä¸æ¥å— ä¸»èŠ‚ç‚¹è¢«æ‹’ç»åï¼Œä¼šå‡å°index
å½“ä¸»èŠ‚ç‚¹å‡ºé”™æ—¶ï¼Œæ–°ä»»leaderå¼ºåˆ¶ä»¥è‡ªå·±çš„logä¸ºå‡† ä¸»èŠ‚ç‚¹ä¿å­˜æ‰€æœ‰ä»çš„ nextIndex
Safety ä¹‹å‰ä¸¤èŠ‚å¹¶ä¸èƒ½ä¿è¯å„èŠ‚ç‚¹ exec same command in same orderã€‚æ¯”å¦‚ä¸€ä¸ªè½åå¾ˆå¤šçš„èŠ‚ç‚¹ï¼Œtimeoutåç«é€‰æˆä¸ºä¸»èŠ‚ç‚¹ç„¶åæ‰§è¡Œåç»­å‘½ä»¤ä¼šå¯¼è‡´å…¶ä»–èŠ‚ç‚¹å‡ºé”™ã€‚
è¿™ä¸€èŠ‚æ·»åŠ äº†é€‰ä¸ºä¸»èŠ‚ç‚¹çš„é™åˆ¶ã€‚ä¿è¯æ¯ä¸ªä»»æœŸçš„leaderéƒ½æŒæœ‰æ‰€æœ‰å·²æäº¤çš„å‘½ä»¤ã€‚ å¹¶ä¸”ç²¾ç»†äº†commitçš„è§„åˆ™ æœ€åï¼Œç»™å‡ºäº†è¯æ˜
5.4.1 election restriction æœ‰ä¸»èŠ‚ç‚¹çš„å…±è¯†ç®—æ³•ï¼Œä¸»èŠ‚ç‚¹å¿…é¡»å­˜å‚¨æ‰€æœ‰å·²æäº¤entriesã€‚
Raftåœ¨ä¸å‘ä¸»èŠ‚ç‚¹ä¼ é€’æ—¥å¿—çš„æƒ…å†µä¸‹å®ç°è¿™ä¸€ç‚¹ã€‚logæµå‘åªä¼šä»ä¸»èŠ‚ç‚¹å‘å¾€å…¶ä»–...</p></div><footer class=entry-footer><span title='2022-05-02 13:08:10 +0800 CST'>May 2, 2022</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;79 words&nbsp;Â·&nbsp;homily</footer><a class=entry-link aria-label="post link to 6.824 Lab2 Paper" href=https://homily707.github.io/posts/db/6.824-lab2-paper/></a></article><article class=post-entry><header class=entry-header><h2>6.824 Lab2 Guide</h2></header><div class=entry-content><p>guidance Read this guide for Raft specific advice. Advice on locking in labs. Advice on structuring your Raft lab. This Diagram of Raft interactions may help you understand code flow between different parts of the system. Dprint and colorful print debuging faultå›  error æœ ï¼ˆéšè—çš„errorï¼Œ å‡ºç°çš„errorï¼Œmaskedçš„errorï¼‰ ç¨‹åºçš„ä¸‰ç§çŠ¶æ€
ç¨‹åºæ­£ç¡®ï¼Œä½†æ˜¯å·²ç»æœ‰ fault faultå·²ç»äº§ç”Ÿlatent errorã€‚ä½†æ˜¯è¿˜æœªæ˜æ˜¾å½±å“ç¨‹åºçŠ¶æ€ errorå‡ºç° åšæ³•
æƒ³åŠæ³•ï¼Œå‡å°‘é˜¶æ®µ2æŒç»­çš„æ—¶é—´ï¼Œæ‰€ä»¥å°±èƒ½æ›´å¿«çš„å®šä½1åˆ‡æ¢åˆ°2çš„æ—¶å€™ã€‚ ä¿æŒå¤´è„‘æ¸…é†’ï¼Œèšç„¦å½“å‰çš„first observable errorï¼Œä¸åœçš„å¾€å‰è¿½æº¯ã€‚ bisection instrumentation
è¦èƒ½æ–¹ä¾¿åœ°è°ƒèŠ‚logçš„è¯¦ç»†ç¨‹åº¦ å¯è¯»æ€§ï¼Œé¢œè‰²ï¼Œä¿æŒä¸€è‡´çš„è¾“å‡º åŠ å¼ºæ–°å¢æ—¥å¿—èƒ½åŠ› tips
å¤šä¸ªfaultsæ—¶ï¼Œå…ˆæ‰¾ç¬¬ä¸€ä¸ª ä¸è¦è½»æ˜“æ’é™¤ï¼Œä¸è¦ä¾èµ–ä½ è„‘æµ·ä¸­çš„æ¨¡å‹ï¼Œalways verify your assumptions å¤ç›˜ ä¸è¦åš ä¸æˆç†Ÿçš„è¡¥æ•‘ fail loudlyï¼Œ offensive programming å¶å‘bugï¼Œç–¯ç‹‚çš„è¾“å‡ºæ—¥å¿—ï¼Œåç­‰å¤ç° å…ˆæƒ³æƒ³what the fuck the test is doing</p></div><footer class=entry-footer><span title='2022-05-02 11:37:08 +0800 CST'>May 2, 2022</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;83 words&nbsp;Â·&nbsp;homily</footer><a class=entry-link aria-label="post link to 6.824 Lab2 Guide" href=https://homily707.github.io/posts/db/6.824-lab2-guide/></a></article><article class=post-entry><header class=entry-header><h2>Prometheus</h2></header><div class=entry-content><p>å…¥é—¨Prometheus æ¶æ„åŸç† PromQl grafana å®æˆ˜ slo metrics exporter microMeters å‘Šè­¦ å…¶ä»– é•¿å°¾æ•ˆåº” pushgateway exporter å…¥é—¨prometheus æ¶æ„åŸç† Prometheus é¡¹ç›®å·¥ä½œçš„æ ¸å¿ƒï¼Œæ˜¯ä½¿ç”¨ Pull ï¼ˆæŠ“å–ï¼‰çš„æ–¹å¼å»æœé›†è¢«ç›‘æ§å¯¹è±¡çš„ Metrics æ•°æ®ï¼ˆç›‘æ§æŒ‡æ ‡æ•°æ®ï¼‰ï¼Œç„¶åï¼Œå†æŠŠè¿™äº›æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ª TSDB ï¼ˆæ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œæ¯”å¦‚ OpenTSDBã€InfluxDB ç­‰ï¼‰å½“ä¸­ï¼Œä»¥ä¾¿åç»­å¯ä»¥æŒ‰ç…§æ—¶é—´è¿›è¡Œæ£€ç´¢ã€‚grafanaé€šè¿‡PromQLæŸ¥è¯¢æ•°æ®ï¼Œé…ç½®ç›¸å…³çš„å¯è§†åŒ–ç•Œé¢ã€‚AlertManagerè´Ÿè´£å‘å‡ºå‘Šè­¦ã€‚ metrics æ¥æº
æ¥è‡ªå®¿ä¸»æœºçš„ Node Exporterï¼Œ æ¥è‡ªAPI Serverçš„æ•°æ®ç›‘æ§controllerçš„ç›¸å…³ä¿¡æ¯ kubelet cAdvisorï¼Œk8sæ ¸å¿ƒæ•°æ®ï¼Œpodï¼Œcontainer cpuç­‰ ç»„ä»¶ exporter PromQL æ•°æ®ç±»å‹ counter åªå¢ä¸å‡ gauage å¯å¢å¯å‡ histogram åˆ† bucket summary æ˜¾ç¤ºç™¾åˆ†ä½æ•° ç­›é€‰ {}é€šè¿‡label ç­›é€‰ ç±»ä¼¼sqlçš„ whereã€‚æ”¯æŒæ­£åˆ™ è¿”å›ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œç¬æ—¶å‘é‡ http_requests_total{job=â€œprometheusâ€,group=â€œcanaryâ€}
å‘é‡ [ ] æ—¶é—´æ®µæŸ¥è¯¢rangeï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼ŒåŒºé—´å‘é‡ã€‚å¾€å¾€éœ€è¦é…åˆå‡½æ•°ä½¿ç”¨ http_requests_total{job=â€œprometheusâ€}[5m]
æ“ä½œç¬¦ ä¸¤ä¸ªå‘é‡ä¹‹é—´å¯ä»¥ç›´æ¥ ç›¸åŠ ç›¸ä¹˜ç›¸é™¤ï¼Œä½†è¿™é‡Œéœ€è¦æ³¨æ„åŒ¹é…æ¨¡å¼ã€‚é»˜è®¤æ˜¯1å¯¹1åŒ¹é…ã€‚å¦‚æœè¦1å¯¹å¤šå’Œå¤šå¯¹1ï¼Œéœ€è¦é¢å¤–å¤„ç†ã€‚
èšåˆæ“ä½œ èšåˆæ“ä½œæœ‰äº›ç”¨äºç¬æ—¶å‘é‡ ç±»ä¼¼äº sql çš„ group æ¯”å¦‚ sum(http_requests_total) by (code,handler,job,method) å¸¸ç”¨çš„è¿˜æœ‰ max,min,avg, count_values topk quantile æœ‰äº›ç”¨äºåŒºé—´å‘é‡ ï¼Œå¸¸ç”¨ increaseã€rateã€irate è¿™é‡Œæœ‰2ç¯‡æ–‡ç« è¯¦è§£rate https://www....</p></div><footer class=entry-footer><span title='2022-04-23 22:39:02 +0800 CST'>April 23, 2022</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;224 words&nbsp;Â·&nbsp;homily</footer><a class=entry-link aria-label="post link to Prometheus" href=https://homily707.github.io/posts/k8s/prometheus/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://homily707.github.io/page/2/>Next Â»</a></nav></footer></main><footer class=footer><span>&copy; 2022 <a href=https://homily707.github.io/>æ–¯æ˜¯é™‹å®¤</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>